<?php

namespace App\Http\Controllers\Api\V2\Front\ListingFrontC;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Route;
use LaravelJsonApi\Core\Document\Error;
use LaravelJsonApi\Core\Responses\ErrorResponse;
use LaravelJsonApi\Core\Responses\DataResponse;
use LaravelJsonApi\Laravel\Http\Controllers\JsonApiController;
use Illuminate\Support\Facades\Storage;
use App\Enums\ItemStatus;







use LaravelJsonApi\Contracts\Store\Store;
use LaravelJsonApi\Contracts\Routing\Route as JsonApiRoute;


use App\Models\Review;

use App\Models\Reviewreply;

use App\Models\Favorite;

use App\Models\Listing;
use App\Models\User;

use App\Models\Reservation;




use App\Models\Billiard;
use App\Models\Boxing;
use App\Models\Diving  ;
use App\Models\Football  ;
use App\Models\Golf  ;
use App\Models\Hunting  ;
use App\Models\Musculation  ;
use App\Models\Surf  ;
use App\Models\Tennis  ;



use App\Models\Audio  ;
use App\Models\Camera  ;
use App\Models\Charger  ;
use App\Models\Drone  ;
use App\Models\Gaming  ;
use App\Models\Laptop  ;
use App\Models\Lighting  ;
use App\Models\Printer  ;
use App\Models\Router  ;
use App\Models\Tablette  ;


use App\Models\Eclairage  ;
use App\Models\Mobilier  ;
use App\Models\Photographie  ;
use App\Models\Sonorisation  ;
use App\Models\Tente  ;


use App\Models\Clothes  ;
use App\Models\Jewelry  ;


use App\Models\Apartment  ;
use App\Models\Bureaux  ;
use App\Models\Magasin  ;
use App\Models\Maison  ;
use App\Models\Riad  ;
use App\Models\Terrain  ;
use App\Models\Villa  ;


use App\Models\Activity  ;
use App\Models\Livre  ;
use App\Models\Musical  ;


use App\Models\Furniture  ;
use App\Models\Houseappliance  ;


use App\Models\Electricaltool  ;
use App\Models\Ladder  ;
use App\Models\Mechanicaltool  ;
use App\Models\Powertool  ;
use App\Models\Pressurewasher  ;



use App\Models\Service  ;



use App\Models\Boat  ;
use App\Models\Camion  ;
use App\Models\Caravan  ;
use App\Models\Car  ;
use App\Models\Engin  ;
use App\Models\Moto  ;
use App\Models\Scooter  ;
use App\Models\Taxiaeroport  ;
use App\Models\Transportation  ;
use App\Models\Velo  ;




use App\Models\Billiardsimg;
use App\Models\Boxingsimg;
use App\Models\Divingsimg;
use App\Models\Footballsimg;
use App\Models\Golfsimg;
use App\Models\Huntingsimg;
use App\Models\Musculationsimg;
use App\Models\Surfsimg;
use App\Models\Tennisimg;

use App\Models\Audiosimg;
use App\Models\Camerasimg;
use App\Models\Chargersimg;
use App\Models\Dronesimg;
use App\Models\Gamingsimg;
use App\Models\Laptopsimg;
use App\Models\Lightingsimg;
use App\Models\Printersimg;
use App\Models\Routersimg;
use App\Models\Tablettesimg;

use App\Models\Eclairagesimg;
use App\Models\Mobiliersimg;
use App\Models\Photographiesimg;
use App\Models\Sonorisationsimg;
use App\Models\Tentesimg;

use App\Models\Clothesimg;
use App\Models\Jewelrysimg;

use App\Models\Apartmentsimg;
use App\Models\Bureauxsimg;
use App\Models\Magasinsimg;
use App\Models\Maisonsimg;
use App\Models\Riadsimg;
use App\Models\Terrainsimg;
use App\Models\Villasimg;

use App\Models\Activitiesimg;
use App\Models\Livresimg;
use App\Models\Musicalsimg;

use App\Models\Furnituresimg;
use App\Models\Houseappliancesimg;

use App\Models\Electricaltoolsimg;
use App\Models\Laddersimg;
use App\Models\Mechanicaltoolsimg;
use App\Models\Powertoolsimg;
use App\Models\Pressurewashersimg;

use App\Models\Servicesimg;

use App\Models\Boatsimg;
use App\Models\Camionsimg;
use App\Models\Caravansimg;
use App\Models\Carsimg;
use App\Models\Enginsimg;
use App\Models\Motosimg;
use App\Models\Scootersimg;
use App\Models\Taxiaeroportsimg;
use App\Models\Transportationsimg;
use App\Models\Velosimg;

use App\Models\Generaleinfo;






class ListingFrontController extends JsonApiController
{


    protected $category;
    protected $listingcategory;
    protected $url;
    protected $review;
    protected $reservations;
    protected $reviewslistings;
    protected $user;
    protected $reviewreplies;



    public function getListing(Request $request, $category, $url)
    {






        $this->category = $category;

        $this->url = $url;

        $authuser = Auth::user();

        $generaleinfo = Generaleinfo::find(1);






        $favorites = Favorite::where('user_id', $authuser->id)->get();







        $billiard_ids = array_filter($favorites->pluck('billiard_id')->toArray());
        $boxing_ids = array_filter($favorites->pluck('boxing_id')->toArray());
        $diving_ids = array_filter($favorites->pluck('diving_id')->toArray());
        $football_ids = array_filter($favorites->pluck('football_id')->toArray());
        $golf_ids = array_filter($favorites->pluck('golf_id')->toArray());
        $hunting_ids = array_filter($favorites->pluck('hunting_id')->toArray());
        $musculation_ids = array_filter($favorites->pluck('musculation_id')->toArray());
        $surf_ids = array_filter($favorites->pluck('surf_id')->toArray());
        $tennis_ids = array_filter($favorites->pluck('tennis_id')->toArray());
        $audio_ids = array_filter($favorites->pluck('audio_id')->toArray());
        $camera_ids = array_filter($favorites->pluck('camera_id')->toArray());
        $charger_ids = array_filter($favorites->pluck('charger_id')->toArray());
        $drone_ids = array_filter($favorites->pluck('drone_id')->toArray());
        $gaming_ids = array_filter($favorites->pluck('gaming_id')->toArray());
        $laptop_ids = array_filter($favorites->pluck('laptop_id')->toArray());
        $lighting_ids = array_filter($favorites->pluck('lighting_id')->toArray());
        $printer_ids = array_filter($favorites->pluck('printer_id')->toArray());
        $router_ids = array_filter($favorites->pluck('router_id')->toArray());
        $tablette_ids = array_filter($favorites->pluck('tablette_id')->toArray());
        $eclairage_ids = array_filter($favorites->pluck('eclairage_id')->toArray());
        $mobilier_ids = array_filter($favorites->pluck('mobilier_id')->toArray());
        $photographie_ids = array_filter($favorites->pluck('photographie_id')->toArray());
        $sonorisation_ids = array_filter($favorites->pluck('sonorisation_id')->toArray());
        $tente_ids = array_filter($favorites->pluck('tente_id')->toArray());
        $clothes_ids = array_filter($favorites->pluck('clothes_id')->toArray());
        $jewelry_ids = array_filter($favorites->pluck('jewelry_id')->toArray());
        $apartment_ids = array_filter($favorites->pluck('apartment_id')->toArray());
        $bureaux_ids = array_filter($favorites->pluck('bureaux_id')->toArray());
        $magasin_ids = array_filter($favorites->pluck('magasin_id')->toArray());
        $maison_ids = array_filter($favorites->pluck('maison_id')->toArray());
        $riad_ids = array_filter($favorites->pluck('riad_id')->toArray());
        $terrain_ids = array_filter($favorites->pluck('terrain_id')->toArray());
        $villa_ids = array_filter($favorites->pluck('villa_id')->toArray());
        $activity_ids = array_filter($favorites->pluck('activity_id')->toArray());
        $livre_ids = array_filter($favorites->pluck('livre_id')->toArray());
        $musical_ids = array_filter($favorites->pluck('musical_id')->toArray());
        $furniture_ids = array_filter($favorites->pluck('furniture_id')->toArray());
        $houseappliance_ids = array_filter($favorites->pluck('houseappliance_id')->toArray());
        $electricaltool_ids = array_filter($favorites->pluck('electricaltool_id')->toArray());
        $ladder_ids = array_filter($favorites->pluck('ladder_id')->toArray());
        $mechanicaltool_ids = array_filter($favorites->pluck('mechanicaltool_id')->toArray());
        $powertool_ids = array_filter($favorites->pluck('powertool_id')->toArray());
        $pressurewasher_ids = array_filter($favorites->pluck('pressurewasher_id')->toArray());
        $service_ids = array_filter($favorites->pluck('service_id')->toArray());
        $boat_ids = array_filter($favorites->pluck('boat_id')->toArray());
        $camion_ids = array_filter($favorites->pluck('camion_id')->toArray());
        $caravan_ids = array_filter($favorites->pluck('caravan_id')->toArray());
        $car_ids = array_filter($favorites->pluck('car_id')->toArray());
        $engin_ids = array_filter($favorites->pluck('engin_id')->toArray());
        $moto_ids = array_filter($favorites->pluck('moto_id')->toArray());
        $scooter_ids = array_filter($favorites->pluck('scooter_id')->toArray());
        $taxiaeroport_ids = array_filter($favorites->pluck('taxiaeroport_id')->toArray());
        $transportation_ids = array_filter($favorites->pluck('transportation_id')->toArray());
        $velo_ids = array_filter($favorites->pluck('velo_id')->toArray());




        $favoriteIds = array_merge(
            $billiard_ids,
            $boxing_ids,
            $diving_ids,
            $football_ids,
            $golf_ids,
            $hunting_ids,
            $musculation_ids,
            $surf_ids,
            $tennis_ids,
            $audio_ids,
            $camera_ids,
            $charger_ids,
            $drone_ids,
            $gaming_ids,
            $laptop_ids,
            $lighting_ids,
            $printer_ids,
            $router_ids,
            $tablette_ids,
            $eclairage_ids,
            $mobilier_ids,
            $photographie_ids,
            $sonorisation_ids,
            $tente_ids,
            $clothes_ids,
            $jewelry_ids,
            $apartment_ids,
            $bureaux_ids,
            $magasin_ids,
            $maison_ids,
            $riad_ids,
            $terrain_ids,
            $villa_ids,
            $activity_ids,
            $livre_ids,
            $musical_ids,
            $furniture_ids,
            $houseappliance_ids,
            $electricaltool_ids,
            $ladder_ids,
            $mechanicaltool_ids,
            $powertool_ids,
            $pressurewasher_ids,
            $service_ids,
            $boat_ids,
            $camion_ids,
            $caravan_ids,
            $car_ids,
            $engin_ids,
            $moto_ids,
            $scooter_ids,
            $taxiaeroport_ids,
            $transportation_ids,
            $velo_ids
        );












        switch ($this->category) {



            case 'billiards':


                        $this->listingcategory = Billiard::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();


                                // Fetch 10 recent listings


                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'table_brand' => $this->listingcategory->table_brand,
                                        'condition' => $this->listingcategory->condition,
                                        'balls_design' => $this->listingcategory->balls_design,
                                        'bridge_stick' => $this->listingcategory->bridge_stick,
                                        'chalk' => $this->listingcategory->chalk,
                                        'other_information' => $this->listingcategory->scoreboards,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],

                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Billiardsimg::where('billiard_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place


                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Billiard::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'billiards',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Billiard::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Billiard::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Billiard::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Billiard::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Billiard::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Billiard::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Billiard::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Billiard::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Billiard::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Billiard::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Billiard::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Billiard::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Billiard::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Billiard::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Billiard::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Billiard::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Billiard::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'billiards',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],





                                ],
                            ],
                        ]);








                break;





            case 'boxings':


                        $this->listingcategory = Boxing::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                    'brand_name' => $this->listingcategory->brand_name,
                                    'ring_dimensions' => $this->listingcategory->ring_dimensions,
                                    'padding_thickness' => $this->listingcategory->padding_thickness,
                                    'boxing_clothing' => $this->listingcategory->boxing_clothing,
                                    'other_equipment' => $this->listingcategory->other_equipment,
                                    'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Boxingsimg::where('boxing_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Boxing::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'boxings',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Boxing::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Boxing::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Boxing::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Boxing::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Boxing::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Boxing::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Boxing::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Boxing::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Boxing::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Boxing::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Boxing::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Boxing::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Boxing::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Boxing::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Boxing::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Boxing::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Boxing::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boxings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);







                break;






            case 'divings':




                $this->listingcategory = Diving::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'brand_name' => $this->listingcategory->brand_name,
                                        'material' => $this->listingcategory->material,
                                        'other_equipment' => $this->listingcategory->other_equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],



                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Divingsimg::where('diving_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Diving::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'divings',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Diving::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Diving::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Diving::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Diving::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Diving::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Diving::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Diving::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Diving::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Diving::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Diving::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Diving::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Diving::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Diving::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Diving::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Diving::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Diving::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Diving::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'divings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);








                break;







            case 'footballs':




                $this->listingcategory = Football::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'type' => $this->listingcategory->type,
                                        'equipment' => $this->listingcategory->equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],

                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),







                                        'favorites' => $favoriteIds,


                                        'recentlistings' => Football::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                            return [

                                                'attributes' => [

                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'footballs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                                ],

                                            ];
                                        }),


                                        'recentlistingscasablanca' => Football::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingsmarrakech' => Football::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingstanger' => Football::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),




                                        'recentlistingsrabat' => Football::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingsfes' => Football::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingsagadir' => Football::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingsmeknes' => Football::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),

                                        'recentlistingsojuda' => Football::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),






                                        'recentlistingskenitra' => Football::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingstetouan' => Football::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingssale' => Football::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingstemara' => Football::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingssafi' => Football::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingsmohammedia' => Football::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingskhouribga' => Football::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentListingseljadida' => Football::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),
                                        'recentlistingsbenimellal' => Football::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                            return [
                                                'attributes' => [
                                                    'title' => $recentlisting->title,
                                                    'price' => $recentlisting->price,
                                                    'city' => $recentlisting->city,
                                                    'id' => $recentlisting->id,
                                                    'category' => 'footballs',
                                                    'url' => $recentlisting->url,
                                                    'created_at' => $recentlisting->created_at->toIso8601String(),
                                                    'picture' => $recentlisting->picture,
                                                ],
                                            ];
                                        }),




                                        'socials' => [
                                                'facebook' => $generaleinfo->facebook,
                                                'twitter' => $generaleinfo->twitter, // X / Twitter
                                                'instagram' => $generaleinfo->instagram,
                                                'linkedin' => $generaleinfo->linkedin,
                                                'pinterest' => $generaleinfo->pinterest,
                                                'telegram' => $generaleinfo->telegram,
                                                'tiktok' => $generaleinfo->tiktok,
                                                'youtube' => $generaleinfo->youtube,
                                        ],










                                        ];
                                    }),




                                    'images' => Footballsimg::where('football_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place



                                ],
                            ],
                        ]);







                break;







            case 'golfs':



                $this->listingcategory = Golf::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'clothing' => $this->listingcategory->clothing,
                                        'golf_cars' => $this->listingcategory->golf_cars,
                                        'other_equipment' => $this->listingcategory->other_equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Golfsimg::where('golf_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Golf::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'golfs',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Golf::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Golf::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Golf::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Golf::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Golf::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Golf::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Golf::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Golf::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Golf::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Golf::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Golf::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Golf::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Golf::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Golf::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Golf::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Golf::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Golf::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'golfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],










                                ],
                            ],
                        ]);








                break;








            case 'huntings':



                $this->listingcategory = Hunting::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'bow_arrow' => $this->listingcategory->bow_arrow,
                                        'crossbow' => $this->listingcategory->crossbow,
                                        'decoy' => $this->listingcategory->decoy,
                                        'game_call' => $this->listingcategory->game_call,
                                        'binoculars' => $this->listingcategory->binoculars,
                                        'clothing' => $this->listingcategory->clothing,
                                        'equipment' => $this->listingcategory->equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Huntingsimg::where('hunting_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Hunting::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'huntings',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Hunting::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Hunting::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Hunting::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Hunting::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Hunting::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Hunting::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Hunting::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Hunting::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Hunting::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Hunting::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Hunting::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Hunting::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Hunting::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Hunting::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Hunting::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Hunting::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Hunting::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'huntings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],










                                ],
                            ],
                        ]);








                break;







            case 'musculations':



                $this->listingcategory = Musculation::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'brand_name' => $this->listingcategory->brand_name,
                                        'arms' => $this->listingcategory->arms,
                                        'back' => $this->listingcategory->back,
                                        'shoulders' => $this->listingcategory->shoulders,
                                        'glutes' => $this->listingcategory->glutes,
                                        'legs' => $this->listingcategory->legs,
                                        'chest' => $this->listingcategory->chest,
                                        'abs' => $this->listingcategory->abs,
                                        'cardio_machines' => $this->listingcategory->cardio_machines,
                                        'dumbbells' => $this->listingcategory->dumbbells,

                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Musculationsimg::where('musculation_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Musculation::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'musculations',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Musculation::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Musculation::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Musculation::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Musculation::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Musculation::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Musculation::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Musculation::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Musculation::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Musculation::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Musculation::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Musculation::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Musculation::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Musculation::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Musculation::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Musculation::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Musculation::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Musculation::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musculations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],












                                ],
                            ],
                        ]);








                break;








            case 'surfs':


                $this->listingcategory = Surf::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'surf_category' => $this->listingcategory->surf_category,
                                        'board_types' => $this->listingcategory->board_types,
                                        'board_size' => $this->listingcategory->board_size,
                                        'wetsuits' => $this->listingcategory->wetsuits,
                                        'surf_other' => $this->listingcategory->surf_other,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],



                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Surfsimg::where('surf_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Surf::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'surfs',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Surf::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Surf::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Surf::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Surf::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Surf::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Surf::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Surf::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Surf::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Surf::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Surf::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Surf::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Surf::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Surf::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Surf::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Surf::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Surf::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Surf::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'surfs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],










                                ],
                            ],
                        ]);








                break;







            case 'tennis':


                $this->listingcategory = Tennis::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'terrain_dimensions' => $this->listingcategory->terrain_dimensions,
                                        'brand' => $this->listingcategory->brand,
                                        'clothing' => $this->listingcategory->clothing,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Tennisimg::where('tennis_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Tennis::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'tennis',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Tennis::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Tennis::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Tennis::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Tennis::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Tennis::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Tennis::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Tennis::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Tennis::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Tennis::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Tennis::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Tennis::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Tennis::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Tennis::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Tennis::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Tennis::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Tennis::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Tennis::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tennis',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);








                break;







            case 'audios':


                $this->listingcategory = Audio::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'audio_type' => $this->listingcategory->audio_type,
                                        'sound_quality' => $this->listingcategory->sound_quality,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'max_wireless_range' => $this->listingcategory->max_wireless_range,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'charging_time' => $this->listingcategory->charging_time,
                                        'condition' => $this->listingcategory->condition,
                                        'compatibility' => $this->listingcategory->compatibility,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Audiosimg::where('audio_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Audio::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'audios',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Audio::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Audio::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Audio::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Audio::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Audio::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Audio::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Audio::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Audio::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Audio::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Audio::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Audio::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Audio::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Audio::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Audio::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Audio::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Audio::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Audio::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'audios',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);








                break;







            case 'cameras':



                $this->listingcategory = Camera::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'photo_size' => $this->listingcategory->photo_size,
                                        'sensor_size' => $this->listingcategory->sensor_size,
                                        'image_stabilization' => $this->listingcategory->image_stabilization,
                                        'shutter_speed' => $this->listingcategory->shutter_speed,
                                        'exposure_control' => $this->listingcategory->exposure_control,
                                        'image_resolution' => $this->listingcategory->image_resolution,
                                        'condition' => $this->listingcategory->condition,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'memory' => $this->listingcategory->memory,
                                        'lens' => $this->listingcategory->lens,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Camerasimg::where('camera_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Camera::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'cameras',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Camera::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Camera::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Camera::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Camera::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Camera::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Camera::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Camera::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Camera::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Camera::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Camera::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Camera::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Camera::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Camera::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Camera::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Camera::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Camera::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Camera::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cameras',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);







                break;






            case 'chargers':



                $this->listingcategory = Charger::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'compatibility' => $this->listingcategory->compatibility,
                                        'number_of_ports' => $this->listingcategory->number_of_ports,
                                        'length' => $this->listingcategory->length,
                                        'input_voltage' => $this->listingcategory->input_voltage,
                                        'wattage' => $this->listingcategory->wattage,
                                        'condition' => $this->listingcategory->condition,
                                        'connector_type' => $this->listingcategory->connector_type,
                                        'amperage' => $this->listingcategory->amperage,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Chargersimg::where('charger_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Charger::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'chargers',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Charger::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Charger::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Charger::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Charger::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Charger::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Charger::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Charger::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Charger::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Charger::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Charger::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Charger::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Charger::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Charger::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Charger::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Charger::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Charger::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Charger::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'chargers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);








                break;






            case 'drones':



                $this->listingcategory = Drone::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'flight_time' => $this->listingcategory->flight_time,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'condition' => $this->listingcategory->condition,
                                        'video_resolution' => $this->listingcategory->video_resolution,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'battery_capacity' => $this->listingcategory->battery_capacity,
                                        'memory' => $this->listingcategory->memory,
                                        'image_resolution' => $this->listingcategory->image_resolution,
                                        'included_components' => $this->listingcategory->included_components,
                                        'remote_control' => $this->listingcategory->remote_control,
                                        'max_distance' => $this->listingcategory->max_distance,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Dronesimg::where('drone_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Drone::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'drones',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Drone::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Drone::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Drone::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Drone::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Drone::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Drone::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Drone::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Drone::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Drone::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Drone::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Drone::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Drone::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Drone::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Drone::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Drone::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Drone::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Drone::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'drones',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);








                break;









            case 'gamings':



                $this->listingcategory = Gaming::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'storage' => $this->listingcategory->storage,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'ports' => $this->listingcategory->ports,
                                        'online_services' => $this->listingcategory->online_services,
                                        'condition' => $this->listingcategory->condition,
                                        'games' => $this->listingcategory->games,
                                        'controllers' => $this->listingcategory->controllers,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Gamingsimg::where('gaming_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Gaming::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'gamings',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Gaming::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Gaming::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Gaming::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Gaming::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Gaming::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Gaming::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Gaming::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Gaming::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Gaming::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Gaming::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Gaming::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Gaming::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Gaming::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Gaming::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Gaming::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Gaming::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Gaming::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'gamings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;







            case 'laptops':




                $this->listingcategory = Laptop::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'ram' => $this->listingcategory->ram,
                                        'graphics_card' => $this->listingcategory->graphics_card,
                                        'operating_system' => $this->listingcategory->operating_system,
                                        'number_ports' => $this->listingcategory->number_ports,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'drive_storage' => $this->listingcategory->drive_storage,
                                        'resolution' => $this->listingcategory->resolution,
                                        'weight' => $this->listingcategory->weight,
                                        'screen_size' => $this->listingcategory->screen_size,
                                        'cpu' => $this->listingcategory->cpu,
                                        'condition' => $this->listingcategory->condition,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Laptopsimg::where('laptop_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Laptop::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'laptops',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Laptop::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Laptop::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Laptop::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Laptop::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Laptop::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Laptop::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Laptop::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Laptop::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Laptop::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Laptop::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Laptop::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Laptop::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Laptop::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Laptop::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Laptop::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Laptop::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Laptop::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'laptops',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);




                break;








            case 'lightings':



                $this->listingcategory = Lighting::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'included_accessories' => $this->listingcategory->included_accessories,
                                        'condition' => $this->listingcategory->condition,
                                        'color_temperature' => $this->listingcategory->color_temperature,
                                        'compatibility' => $this->listingcategory->compatibility,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],

                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Lightingsimg::where('lighting_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Lighting::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'lightings',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Lighting::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Lighting::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Lighting::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Lighting::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Lighting::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Lighting::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Lighting::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Lighting::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Lighting::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Lighting::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Lighting::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Lighting::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Lighting::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Lighting::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Lighting::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Lighting::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Lighting::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'lightings',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;








            case 'printers':



                $this->listingcategory = Printer::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'print_speed' => $this->listingcategory->print_speed,
                                        'print_resolution' => $this->listingcategory->print_resolution,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'paper_size' => $this->listingcategory->paper_size,
                                        'compatible' => $this->listingcategory->compatible,
                                        'condition' => $this->listingcategory->condition,
                                        'input_sheets' => $this->listingcategory->input_sheets,
                                        'print_media' => $this->listingcategory->print_media,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Printersimg::where('printer_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Printer::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'printers',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Printer::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Printer::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Printer::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Printer::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Printer::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Printer::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Printer::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Printer::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Printer::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Printer::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Printer::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Printer::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Printer::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Printer::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Printer::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Printer::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Printer::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'printers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);





                break;






            case 'routers':


                $this->listingcategory = Router::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'gbps_speed' => $this->listingcategory->gbps_speed,
                                        'wireless' => $this->listingcategory->wireless,
                                        'frequency' => $this->listingcategory->frequency,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'antennas' => $this->listingcategory->antennas,
                                        'condition' => $this->listingcategory->condition,
                                        'compatible' => $this->listingcategory->compatible,
                                        'signal_coverage' => $this->listingcategory->signal_coverage,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Routersimg::where('router_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Router::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'routers',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Router::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Router::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Router::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Router::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Router::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Router::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Router::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Router::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Router::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Router::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Router::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Router::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Router::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Router::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Router::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Router::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Router::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'routers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);







                break;







            case 'tablettes':


                $this->listingcategory = Tablette::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'operating_system' => $this->listingcategory->operating_system,
                                        'ram' => $this->listingcategory->ram,
                                        'storage' => $this->listingcategory->storage,
                                        'display_size' => $this->listingcategory->display_size,
                                        'display_resolution' => $this->listingcategory->display_resolution,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'condition' => $this->listingcategory->condition,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Tablettesimg::where('tablette_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Tablette::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'tablettes',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Tablette::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Tablette::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Tablette::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Tablette::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Tablette::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Tablette::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Tablette::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Tablette::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Tablette::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Tablette::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Tablette::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Tablette::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Tablette::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Tablette::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Tablette::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Tablette::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Tablette::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tablettes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);







                break;







            case 'eclairages':


                $this->listingcategory = Eclairage::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'brand_name' => $this->listingcategory->brand_name,
                                        'size' => $this->listingcategory->size,
                                        'voltage' => $this->listingcategory->voltage,
                                        'chandeliers' => $this->listingcategory->chandeliers,
                                        'lamps' => $this->listingcategory->lamps,
                                        'light_fixtures' => $this->listingcategory->light_fixtures,
                                        'projectors' => $this->listingcategory->projectors,
                                        'leds' => $this->listingcategory->leds,
                                        'power_source' => $this->listingcategory->power_source,
                                        'light_source' => $this->listingcategory->light_source,
                                        'light_color' => $this->listingcategory->light_color,
                                        'lighting_method' => $this->listingcategory->lighting_method,
                                        'controller' => $this->listingcategory->controller,
                                        'other' => $this->listingcategory->other,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Eclairagesimg::where('eclairage_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Eclairage::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'eclairages',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Eclairage::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Eclairage::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Eclairage::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Eclairage::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Eclairage::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Eclairage::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Eclairage::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Eclairage::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Eclairage::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Eclairage::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Eclairage::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Eclairage::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Eclairage::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Eclairage::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Eclairage::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Eclairage::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Eclairage::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'eclairages',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);






                break;







            case 'mobiliers':



                $this->listingcategory = Mobilier::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'material' => $this->listingcategory->material,
                                        'theme' => $this->listingcategory->theme,
                                        'plant_decorations' => $this->listingcategory->plant_decorations,
                                        'light_decorations' => $this->listingcategory->light_decorations,
                                        'festive_decorations' => $this->listingcategory->festive_decorations,
                                        'others' => $this->listingcategory->others,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Mobiliersimg::where('mobilier_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Mobilier::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'mobiliers',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Mobilier::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Mobilier::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Mobilier::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Mobilier::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Mobilier::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Mobilier::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Mobilier::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Mobilier::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Mobilier::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Mobilier::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Mobilier::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Mobilier::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Mobilier::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Mobilier::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Mobilier::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Mobilier::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Mobilier::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mobiliers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;







            case 'photographies':



                $this->listingcategory = Photographie::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'size' => $this->listingcategory->size,
                                        'battery' => $this->listingcategory->battery,
                                        'brand_name' => $this->listingcategory->brand_name,
                                        'camera' => $this->listingcategory->camera,
                                        'sensor' => $this->listingcategory->sensor,
                                        'angle' => $this->listingcategory->angle,
                                        'lcd' => $this->listingcategory->lcd,
                                        'other_equipment' => $this->listingcategory->other_equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Photographiesimg::where('photographie_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Photographie::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'photographies',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Photographie::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Photographie::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Photographie::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Photographie::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Photographie::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Photographie::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Photographie::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Photographie::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Photographie::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Photographie::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Photographie::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Photographie::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Photographie::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Photographie::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Photographie::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Photographie::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Photographie::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'photographies',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;






            case 'sonorisations':


                $this->listingcategory = Sonorisation::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'brand_name' => $this->listingcategory->brand_name,
                                        'size' => $this->listingcategory->size,
                                        'connectivity' => $this->listingcategory->connectivity,
                                        'fastener_type' => $this->listingcategory->fastener_type,
                                        'power_source' => $this->listingcategory->power_source,
                                        'output_power' => $this->listingcategory->output_power,
                                        'number_of_channels' => $this->listingcategory->number_of_channels,
                                        'compatibility' => $this->listingcategory->compatibility,
                                        'power_watts' => $this->listingcategory->power_watts,
                                        'power_type' => $this->listingcategory->power_type,
                                        'battery' => $this->listingcategory->battery,
                                        'weight' => $this->listingcategory->weight,
                                        'microphone' => $this->listingcategory->microphone,
                                        'mixage_table' => $this->listingcategory->mixage_table,
                                        'amplifier' => $this->listingcategory->amplifier,
                                        'cables_connectors' => $this->listingcategory->cables_connectors,
                                        'speaker' => $this->listingcategory->speaker,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Sonorisationsimg::where('sonorisation_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Sonorisation::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'sonorisations',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Sonorisation::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Sonorisation::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Sonorisation::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Sonorisation::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Sonorisation::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Sonorisation::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Sonorisation::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Sonorisation::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Sonorisation::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Sonorisation::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Sonorisation::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Sonorisation::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Sonorisation::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Sonorisation::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Sonorisation::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Sonorisation::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Sonorisation::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'sonorisations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);







                break;







            case 'tentes':



                $this->listingcategory = Tente::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'material' => $this->listingcategory->material,
                                        'style' => $this->listingcategory->style,
                                        'fabric_type' => $this->listingcategory->fabric_type,
                                        'other_equipment' => $this->listingcategory->other_equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Tentesimg::where('tente_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Tente::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'tentes',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Tente::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Tente::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Tente::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Tente::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Tente::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Tente::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Tente::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Tente::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Tente::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Tente::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Tente::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Tente::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Tente::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Tente::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Tente::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Tente::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Tente::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'tentes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            case 'clothes':



                $this->listingcategory = Clothes::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'number_of_pieces' => $this->listingcategory->number_of_pieces,
                                        'closure_type' => $this->listingcategory->closure_type,
                                        'strap_type' => $this->listingcategory->strap_type,
                                        'number_of_pockets' => $this->listingcategory->number_of_pockets,
                                        'heel_height' => $this->listingcategory->heel_height,
                                        'condition' => $this->listingcategory->condition,
                                        'color' => $this->listingcategory->color,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Clothesimg::where('clothes_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Clothes::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'clothes',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Clothes::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Clothes::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Clothes::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Clothes::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Clothes::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Clothes::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Clothes::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Clothes::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Clothes::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Clothes::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Clothes::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Clothes::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Clothes::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Clothes::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Clothes::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Clothes::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Clothes::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'clothes',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;







            case 'jewelrys':


                $this->listingcategory = Jewelry::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'type' => $this->listingcategory->type,
                                        'materials' => $this->listingcategory->materials,
                                        'occasion' => $this->listingcategory->occasion,
                                        'chain_type' => $this->listingcategory->chain_type,
                                        'gem_type' => $this->listingcategory->gem_type,
                                        'color' => $this->listingcategory->color,
                                        'closure_type' => $this->listingcategory->closure_type,
                                        'condition' => $this->listingcategory->condition,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Jewelrysimg::where('jewelry_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Jewelry::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'jewelrys',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Jewelry::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Jewelry::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Jewelry::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Jewelry::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Jewelry::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Jewelry::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Jewelry::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Jewelry::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Jewelry::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Jewelry::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Jewelry::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Jewelry::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Jewelry::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Jewelry::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Jewelry::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Jewelry::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Jewelry::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'jewelrys',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);






                break;






            case 'apartments':



                $this->listingcategory = Apartment::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'rooms' => $this->listingcategory->rooms,
                                        'living_rooms' => $this->listingcategory->living_rooms,
                                        'bathrooms' => $this->listingcategory->bathrooms,
                                        'bedrooms' => $this->listingcategory->bedrooms,
                                        'security_system' => $this->listingcategory->security_system,
                                        'equipped_kitchen' => $this->listingcategory->equipped_kitchen,
                                        'service' => $this->listingcategory->service,
                                        'facilities' => $this->listingcategory->facilities,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Apartmentsimg::where('apartment_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Apartment::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'apartments',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Apartment::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Apartment::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Apartment::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Apartment::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Apartment::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Apartment::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Apartment::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Apartment::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Apartment::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Apartment::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Apartment::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Apartment::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Apartment::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Apartment::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Apartment::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Apartment::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Apartment::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'apartments',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;







            case 'bureauxs':




                $this->listingcategory = Bureaux::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'property_type' => $this->listingcategory->property_type,
                                        'security' => $this->listingcategory->security,
                                        'soil_type' => $this->listingcategory->soil_type,
                                        'parking' => $this->listingcategory->parking,
                                        'bathrooms' => $this->listingcategory->bathrooms,
                                        'conference_room' => $this->listingcategory->conference_room,
                                        'building_size' => $this->listingcategory->building_size,
                                        'lighting' => $this->listingcategory->lighting,
                                        'capacity' => $this->listingcategory->capacity,
                                        'bail_type' => $this->listingcategory->bail_type,
                                        'security_deposit' => $this->listingcategory->security_deposit,
                                        'office_taxes' => $this->listingcategory->office_taxes,
                                        'facilities' => $this->listingcategory->facilities,
                                        'amenities' => $this->listingcategory->amenities,
                                        'services' => $this->listingcategory->services,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Bureauxsimg::where('bureaux_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Bureaux::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'bureauxs',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Bureaux::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Bureaux::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Bureaux::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Bureaux::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Bureaux::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Bureaux::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Bureaux::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Bureaux::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Bureaux::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Bureaux::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Bureaux::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Bureaux::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Bureaux::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Bureaux::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Bureaux::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Bureaux::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Bureaux::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'bureauxs',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;






            case 'magasins':



                $this->listingcategory = Magasin::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'property_type' => $this->listingcategory->property_type,
                                        'surface_area' => $this->listingcategory->surface_area,
                                        'capacity' => $this->listingcategory->capacity,
                                        'offices_number' => $this->listingcategory->offices_number,
                                        'individual_offices' => $this->listingcategory->individual_offices,
                                        'floors' => $this->listingcategory->floors,
                                        'garage' => $this->listingcategory->garage,
                                        'approved_uses' => $this->listingcategory->approved_uses,
                                        'facility_size' => $this->listingcategory->facility_size,
                                        'operating_days' => $this->listingcategory->operating_days,
                                        'lighting' => $this->listingcategory->lighting,
                                        'transports' => $this->listingcategory->transports,
                                        'facilities' => $this->listingcategory->facilities,
                                        'amenities' => $this->listingcategory->amenities,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Magasinsimg::where('magasin_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Magasin::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'magasins',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Magasin::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Magasin::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Magasin::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Magasin::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Magasin::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Magasin::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Magasin::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Magasin::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Magasin::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Magasin::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Magasin::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Magasin::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Magasin::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Magasin::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Magasin::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Magasin::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Magasin::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'magasins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            case 'maisons':


                $this->listingcategory = Maison::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'security_system' => $this->listingcategory->security_system,
                                        'rooms' => $this->listingcategory->rooms,
                                        'living_rooms' => $this->listingcategory->living_rooms,
                                        'bedrooms' => $this->listingcategory->bedrooms,
                                        'bathrooms' => $this->listingcategory->bathrooms,
                                        'floors' => $this->listingcategory->floors,
                                        'amenities' => $this->listingcategory->amenities,
                                        'facilities' => $this->listingcategory->facilities,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Maisonsimg::where('maison_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Maison::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'maisons',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Maison::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Maison::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Maison::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Maison::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Maison::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Maison::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Maison::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Maison::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Maison::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Maison::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Maison::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Maison::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Maison::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Maison::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Maison::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Maison::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Maison::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'maisons',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;






            case 'riads':




                $this->listingcategory = Riad::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,



                                    'specifications' => [
                                        'entire_home' => $this->listingcategory->entire_home,
                                        'doorkeeper' => $this->listingcategory->doorkeeper,
                                        'security_system' => $this->listingcategory->security_system,
                                        'equipped_kitchen' => $this->listingcategory->equipped_kitchen,
                                        'wifi' => $this->listingcategory->wifi,
                                        'tv' => $this->listingcategory->tv,
                                        'heating' => $this->listingcategory->heating,
                                        'furniture' => $this->listingcategory->furniture,
                                        'balcony' => $this->listingcategory->balcony,
                                        'air_conditioner' => $this->listingcategory->air_conditioner,
                                        'washing_machine' => $this->listingcategory->washing_machine,
                                        'pool' => $this->listingcategory->pool,
                                        'rooms' => $this->listingcategory->rooms,
                                        'living_rooms' => $this->listingcategory->living_rooms,
                                        'surface' => $this->listingcategory->surface,
                                        'floors' => $this->listingcategory->floors,
                                        'year_construction' => $this->listingcategory->year_construction,
                                        'bedrooms' => $this->listingcategory->bedrooms,
                                        'bathrooms' => $this->listingcategory->bathrooms,
                                        'garden' => $this->listingcategory->garden,
                                        'terrace' => $this->listingcategory->terrace,
                                        'housekeeping' => $this->listingcategory->housekeeping,
                                        'dishwasher' => $this->listingcategory->dishwasher,
                                        'barbecue' => $this->listingcategory->barbecue,
                                        'refrigerator' => $this->listingcategory->refrigerator,
                                        'microwave' => $this->listingcategory->microwave,
                                        'outdoor_furniture' => $this->listingcategory->outdoor_furniture,
                                        'private_entrance' => $this->listingcategory->private_entrance,
                                        'hammam' => $this->listingcategory->hammam,
                                        'jacuzzi' => $this->listingcategory->jacuzzi,
                                        'gym' => $this->listingcategory->gym,
                                        'architecture' => $this->listingcategory->architecture,
                                        'view' => $this->listingcategory->view,
                                        'restaurant' => $this->listingcategory->restaurant,
                                        'spa' => $this->listingcategory->spa,
                                        'airport' => $this->listingcategory->airport,
                                        'smoking_rooms' => $this->listingcategory->smoking_rooms,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],





                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Riadsimg::where('riad_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Riad::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'riads',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Riad::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Riad::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Riad::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Riad::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Riad::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Riad::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Riad::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Riad::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Riad::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Riad::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Riad::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Riad::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Riad::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Riad::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Riad::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Riad::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Riad::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'riads',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;





            case 'terrains':




                $this->listingcategory = Terrain::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'property_type' => $this->listingcategory->property_type,
                                        'property_subtype' => $this->listingcategory->property_subtype,
                                        'total_lot_size' => $this->listingcategory->total_lot_size,
                                        'land_valuation' => $this->listingcategory->land_valuation,
                                        'total_rating' => $this->listingcategory->total_rating,
                                        'road_access' => $this->listingcategory->road_access,
                                        'slope_description' => $this->listingcategory->slope_description,
                                        'property_usage' => $this->listingcategory->property_usage,
                                        'annual_taxes' => $this->listingcategory->annual_taxes,
                                        'deeded_acres' => $this->listingcategory->deeded_acres,
                                        'leased_acres' => $this->listingcategory->leased_acres,
                                        'elevation' => $this->listingcategory->elevation,
                                        'vegetation' => $this->listingcategory->vegetation,
                                        'nearby_usage' => $this->listingcategory->nearby_usage,
                                        'topography' => $this->listingcategory->topography,
                                        'zoning' => $this->listingcategory->zoning,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Terrainsimg::where('terrain_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Terrain::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'terrains',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Terrain::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Terrain::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Terrain::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Terrain::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Terrain::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Terrain::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Terrain::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Terrain::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Terrain::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Terrain::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Terrain::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Terrain::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Terrain::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Terrain::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Terrain::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Terrain::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Terrain::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'terrains',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;







            case 'villas':



                $this->listingcategory = Villa::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'rooms' => $this->listingcategory->rooms,
                                        'living_rooms' => $this->listingcategory->living_rooms,
                                        'bedrooms' => $this->listingcategory->bedrooms,
                                        'bathrooms' => $this->listingcategory->bathrooms,
                                        'view' => $this->listingcategory->view,
                                        'security_system' => $this->listingcategory->security_system,
                                        'facilities' => $this->listingcategory->facilities,
                                        'amenities' => $this->listingcategory->amenities,
                                        'services' => $this->listingcategory->services,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Villasimg::where('villa_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Villa::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'villas',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Villa::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Villa::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Villa::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Villa::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Villa::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Villa::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Villa::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Villa::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Villa::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Villa::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Villa::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Villa::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Villa::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Villa::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Villa::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Villa::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Villa::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'villas',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;






            case 'activities':


                $this->listingcategory = Activity::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'type' => $this->listingcategory->type,
                                        'equipment' => $this->listingcategory->equipment,
                                        'age_requirement' => $this->listingcategory->age_requirement,
                                        'duration' => $this->listingcategory->duration,
                                        'language' => $this->listingcategory->language,
                                        'cancellation' => $this->listingcategory->cancellation,
                                        'safety_equipment' => $this->listingcategory->safety_equipment,
                                        'monitor' => $this->listingcategory->monitor,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Activitiesimg::where('activity_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Activity::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'activities',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Activity::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Activity::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Activity::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Activity::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Activity::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Activity::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Activity::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Activity::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Activity::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Activity::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Activity::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Activity::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Activity::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Activity::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Activity::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Activity::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Activity::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'activities',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],









                                ],
                            ],
                        ]);






                break;






            case 'livres':


                $this->listingcategory = Livre::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'genre' => $this->listingcategory->genre,
                                        'type' => $this->listingcategory->type,
                                        'language' => $this->listingcategory->language,
                                        'format' => $this->listingcategory->format,
                                        'duration' => $this->listingcategory->duration,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],



                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Livresimg::where('livre_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Livre::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'livres',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Livre::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Livre::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Livre::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Livre::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Livre::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Livre::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Livre::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Livre::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Livre::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Livre::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Livre::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Livre::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Livre::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Livre::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Livre::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Livre::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Livre::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'livres',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            case 'musicals':




                $this->listingcategory = Musical::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'music_type' => $this->listingcategory->music_type,
                                        'material' => $this->listingcategory->material,
                                        'style' => $this->listingcategory->style,
                                        'finish_type' => $this->listingcategory->finish_type,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Musicalsimg::where('musical_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Musical::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'musicals',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Musical::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Musical::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Musical::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Musical::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Musical::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Musical::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Musical::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Musical::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Musical::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Musical::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Musical::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Musical::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Musical::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Musical::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Musical::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Musical::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Musical::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'musicals',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;






            case 'furnitures':


                $this->listingcategory = Furniture::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'furniture_type' => $this->listingcategory->furniture_type,
                                        'material' => $this->listingcategory->material,
                                        'shape' => $this->listingcategory->shape,
                                        'cushion_thickness' => $this->listingcategory->cushion_thickness,
                                        'capacity' => $this->listingcategory->capacity,
                                        'fill_material' => $this->listingcategory->fill_material,
                                        'condition' => $this->listingcategory->condition,
                                        'color' => $this->listingcategory->color,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Furnituresimg::where('furniture_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Furniture::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'furnitures',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Furniture::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Furniture::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Furniture::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Furniture::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Furniture::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Furniture::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Furniture::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Furniture::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Furniture::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Furniture::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Furniture::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Furniture::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Furniture::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Furniture::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Furniture::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Furniture::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Furniture::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'furnitures',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);






                break;






            case 'houseappliances':

                $this->listingcategory = Houseappliance::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'access_location' => $this->listingcategory->access_location,
                                        'finish_type' => $this->listingcategory->finish_type,
                                        'cycle_options' => $this->listingcategory->cycle_options,
                                        'inlet_water' => $this->listingcategory->inlet_water,
                                        'installation_method' => $this->listingcategory->installation_method,
                                        'components' => $this->listingcategory->components,
                                        'control_type' => $this->listingcategory->control_type,
                                        'certification' => $this->listingcategory->certification,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Houseappliancesimg::where('houseappliance_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place








                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Houseappliance::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'houseappliances',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Houseappliance::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Houseappliance::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Houseappliance::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Houseappliance::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Houseappliance::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Houseappliance::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Houseappliance::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Houseappliance::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Houseappliance::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Houseappliance::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Houseappliance::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Houseappliance::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Houseappliance::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Houseappliance::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Houseappliance::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Houseappliance::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Houseappliance::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'houseappliances',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);



                break;






            case 'electricaltools':




                $this->listingcategory = Electricaltool::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'tool_type' => $this->listingcategory->tool_type,
                                        'condition' => $this->listingcategory->condition,
                                        'voltage' => $this->listingcategory->voltage,
                                        'amperage' => $this->listingcategory->amperage,
                                        'cord_length' => $this->listingcategory->cord_length,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'display' => $this->listingcategory->display,
                                        'frequency' => $this->listingcategory->frequency,
                                        'temperature' => $this->listingcategory->temperature,
                                        'voltage_sensing_ranges' => $this->listingcategory->voltage_sensing_ranges,
                                        'detector' => $this->listingcategory->detector,
                                        'operating_altitude' => $this->listingcategory->operating_altitude,
                                        'compatible' => $this->listingcategory->compatible,
                                        'bending_angle' => $this->listingcategory->bending_angle,
                                        'accessories' => $this->listingcategory->accessories,
                                        'style' => $this->listingcategory->style,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Electricaltoolsimg::where('Electricaltool_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Electricaltool::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'electricaltools',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Electricaltool::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Electricaltool::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Electricaltool::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Electricaltool::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Electricaltool::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Electricaltool::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Electricaltool::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Electricaltool::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Electricaltool::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Electricaltool::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Electricaltool::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Electricaltool::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Electricaltool::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Electricaltool::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Electricaltool::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Electricaltool::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Electricaltool::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'electricaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            case 'ladders':



                $this->listingcategory = Ladder::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'tool_type' => $this->listingcategory->tool_type,
                                        'condition' => $this->listingcategory->condition,
                                        'power_source' => $this->listingcategory->power_source,
                                        'material' => $this->listingcategory->material,
                                        'height' => $this->listingcategory->height,
                                        'weight' => $this->listingcategory->weight,
                                        'number_of_steps' => $this->listingcategory->number_of_steps,
                                        'load_capacity' => $this->listingcategory->load_capacity,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'style' => $this->listingcategory->style,
                                        'wheel_size' => $this->listingcategory->wheel_size,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Laddersimg::where('ladder_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Ladder::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'ladders',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Ladder::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Ladder::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Ladder::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Ladder::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Ladder::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Ladder::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Ladder::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Ladder::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Ladder::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Ladder::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Ladder::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Ladder::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Ladder::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Ladder::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Ladder::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Ladder::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Ladder::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'ladders',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;






            case 'mechanicaltools':



                $this->listingcategory = Mechanicaltool::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'tool_type' => $this->listingcategory->tool_type,
                                        'condition' => $this->listingcategory->condition,
                                        'power_source' => $this->listingcategory->power_source,
                                        'voltage' => $this->listingcategory->voltage,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'blade_diameter' => $this->listingcategory->blade_diameter,
                                        'material' => $this->listingcategory->material,
                                        'style' => $this->listingcategory->style,
                                        'cutting_width' => $this->listingcategory->cutting_width,
                                        'carburetor_type' => $this->listingcategory->carburetor_type,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Mechanicaltoolsimg::where('mechanicaltool_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Mechanicaltool::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'mechanicaltools',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Mechanicaltool::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Mechanicaltool::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Mechanicaltool::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Mechanicaltool::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Mechanicaltool::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Mechanicaltool::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Mechanicaltool::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Mechanicaltool::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Mechanicaltool::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Mechanicaltool::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Mechanicaltool::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Mechanicaltool::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Mechanicaltool::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Mechanicaltool::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Mechanicaltool::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Mechanicaltool::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Mechanicaltool::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'mechanicaltools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;





            case 'powertools':



                $this->listingcategory = Powertool::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'tool_type' => $this->listingcategory->tool_type,
                                        'condition' => $this->listingcategory->condition,
                                        'power_source' => $this->listingcategory->power_source,
                                        'voltage' => $this->listingcategory->voltage,
                                        'battery_life' => $this->listingcategory->battery_life,
                                        'material' => $this->listingcategory->material,
                                        'noise_level' => $this->listingcategory->noise_level,
                                        'grit_number' => $this->listingcategory->grit_number,
                                        'rotational_speed' => $this->listingcategory->rotational_speed,
                                        'blade_material' => $this->listingcategory->blade_material,
                                        'surface' => $this->listingcategory->surface,
                                        'style' => $this->listingcategory->style,
                                        'amperage' => $this->listingcategory->amperage,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Powertoolsimg::where('powertool_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Powertool::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'powertools',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Powertool::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Powertool::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Powertool::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Powertool::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Powertool::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Powertool::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Powertool::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Powertool::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Powertool::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Powertool::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Powertool::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Powertool::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Powertool::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Powertool::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Powertool::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Powertool::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Powertool::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'powertools',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;






            case 'pressurewashers':



                $this->listingcategory = Pressurewasher::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'tool_type' => $this->listingcategory->tool_type,
                                        'condition' => $this->listingcategory->condition,
                                        'power_source' => $this->listingcategory->power_source,
                                        'power_output' => $this->listingcategory->power_output,
                                        'engine_power' => $this->listingcategory->engine_power,
                                        'hose_length' => $this->listingcategory->hose_length,
                                        'cord_length' => $this->listingcategory->cord_length,
                                        'weight' => $this->listingcategory->weight,
                                        'maximum_flow_rate' => $this->listingcategory->maximum_flow_rate,
                                        'specification_met' => $this->listingcategory->specification_met,
                                        'inlet_connection_type' => $this->listingcategory->inlet_connection_type,
                                        'outlet_connection_size' => $this->listingcategory->outlet_connection_size,
                                        'max_working_temperature' => $this->listingcategory->max_working_temperature,
                                        'connection_type' => $this->listingcategory->connection_type,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Pressurewashersimg::where('pressurewasher_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Pressurewasher::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'pressurewashers',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Pressurewasher::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Pressurewasher::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Pressurewasher::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Pressurewasher::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Pressurewasher::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Pressurewasher::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Pressurewasher::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Pressurewasher::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Pressurewasher::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Pressurewasher::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Pressurewasher::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Pressurewasher::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Pressurewasher::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Pressurewasher::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Pressurewasher::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Pressurewasher::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Pressurewasher::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'pressurewashers',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);




                break;






            case 'services':



                $this->listingcategory = Service::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'languages' => $this->listingcategory->languages,
                                        'experience' => $this->listingcategory->experience,
                                        'response_time' => $this->listingcategory->response_time,
                                        'package' => $this->listingcategory->package,
                                        'revisions' => $this->listingcategory->revisions,
                                        'level' => $this->listingcategory->level,
                                        'orders_queue' => $this->listingcategory->orders_queue,
                                        'jobs_completed' => $this->listingcategory->jobs_completed,
                                        'repeat_hire_rate' => $this->listingcategory->repeat_hire_rate,
                                        'education' => $this->listingcategory->education,
                                        'on_time' => $this->listingcategory->on_time,
                                        'delivery_time' => $this->listingcategory->delivery_time,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Servicesimg::where('service_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Service::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'services',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Service::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Service::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Service::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Service::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Service::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Service::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Service::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Service::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Service::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Service::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Service::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Service::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Service::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Service::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Service::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Service::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Service::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'services',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            case 'boats':


                $this->listingcategory = Boat::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'boat_type' => $this->listingcategory->boat_type,
                                        'capacity' => $this->listingcategory->capacity,
                                        'cabins' => $this->listingcategory->cabins,
                                        'berths_in_cabin' => $this->listingcategory->berths_in_cabin,
                                        'cruising_time' => $this->listingcategory->cruising_time,
                                        'length' => $this->listingcategory->length,
                                        'security' => $this->listingcategory->security,
                                        'navigation' => $this->listingcategory->navigation,
                                        'kitchen_equipment' => $this->listingcategory->kitchen_equipment,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Boatsimg::where('boat_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Boat::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'boats',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Boat::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Boat::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Boat::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Boat::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Boat::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Boat::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Boat::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Boat::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Boat::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Boat::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Boat::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Boat::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Boat::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Boat::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Boat::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Boat::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Boat::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'boats',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;






            case 'camions':


                $this->listingcategory = Camion::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'type' => $this->listingcategory->type,
                                        'fuel_type' => $this->listingcategory->fuel_type,
                                        'condition' => $this->listingcategory->condition,
                                        'transmission' => $this->listingcategory->transmission,
                                        'insurance' => $this->listingcategory->insurance,
                                        'navigation_system' => $this->listingcategory->navigation_system,

                                        'more_details' => $this->listingcategory->more_details,

                                        // Add more specifications as needed
                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Camionsimg::where('camion_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Camion::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'camions',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Camion::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Camion::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Camion::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Camion::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Camion::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Camion::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Camion::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Camion::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Camion::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Camion::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Camion::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Camion::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Camion::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Camion::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Camion::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Camion::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Camion::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'camions',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;





            case 'caravans':


                $this->listingcategory = Caravan::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'gearbox' => $this->listingcategory->gearbox,
                                        'fuel_type' => $this->listingcategory->fuel_type,
                                        'kitchen_equipment' => $this->listingcategory->kitchen_equipment,
                                        'toilet' => $this->listingcategory->toilet,
                                        'furniture' => $this->listingcategory->furniture,
                                        'accessories' => $this->listingcategory->accessories,
                                        'more_details' => $this->listingcategory->more_details,

                                        // Add more specifications as needed
                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Caravansimg::where('caravan_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Caravan::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'caravans',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Caravan::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Caravan::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Caravan::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Caravan::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Caravan::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Caravan::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Caravan::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Caravan::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Caravan::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Caravan::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Caravan::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Caravan::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Caravan::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Caravan::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Caravan::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Caravan::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Caravan::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'caravans',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);





                break;





            case 'cars':


                $this->listingcategory = Car::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'transmission' => $this->listingcategory->transmission,
                                        'fuel_type' => $this->listingcategory->fuel_type,
                                        'number_of_doors' => $this->listingcategory->number_of_doors,
                                        'condition' => $this->listingcategory->condition,
                                        'more_details' => $this->listingcategory->more_details,
                                        'seats' => $this->listingcategory->seats,
                                        'more_details' => $this->listingcategory->more_details,


                                        // Add more specifications as needed
                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Carsimg::where('car_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Car::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'cars',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Car::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Car::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Car::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Car::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Car::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Car::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Car::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Car::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Car::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Car::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Car::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Car::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Car::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Car::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Car::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Car::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Car::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'cars',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);






                break;





            case 'engins':



                $this->listingcategory = Engin::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,


                                    'specifications' => [
                                        'type' => $this->listingcategory->type,
                                        'mechanical_condition' => $this->listingcategory->mechanical_condition,
                                        'transmission' => $this->listingcategory->transmission,
                                        'cab' => $this->listingcategory->cab,
                                        'cab_condition' => $this->listingcategory->cab_condition,
                                        'coupler' => $this->listingcategory->coupler,
                                        'hydraulics' => $this->listingcategory->hydraulics,
                                        'seats' => $this->listingcategory->seats,
                                        'more_details' => $this->listingcategory->more_details,

                                        // Add more specifications as needed
                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Enginsimg::where('engin_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Engin::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'engins',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Engin::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Engin::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Engin::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Engin::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Engin::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Engin::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Engin::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Engin::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Engin::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Engin::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Engin::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Engin::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Engin::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Engin::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Engin::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Engin::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Engin::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'engins',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);






                break;





            case 'motos':


                $this->listingcategory = Moto::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'condition' => $this->listingcategory->condition,
                                        'gearbox' => $this->listingcategory->gearbox,
                                        'insurance' => $this->listingcategory->insurance,
                                        'power' => $this->listingcategory->power,
                                        'speed' => $this->listingcategory->speed,
                                        'toolkit' => $this->listingcategory->toolkit,
                                        'intercom' => $this->listingcategory->intercom,
                                        'more_details' => $this->listingcategory->more_details,


                                        // Add more specifications as needed
                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Motosimg::where('moto_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Moto::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'motos',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Moto::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Moto::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Moto::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Moto::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Moto::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Moto::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Moto::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Moto::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Moto::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Moto::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Moto::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Moto::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Moto::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Moto::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Moto::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Moto::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Moto::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'motos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);






                break;





            case 'scooters':


                $this->listingcategory = Scooter::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'condition' => $this->listingcategory->condition,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],



                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Scootersimg::where('scooter_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Scooter::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'scooters',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Scooter::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Scooter::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Scooter::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Scooter::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Scooter::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Scooter::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Scooter::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Scooter::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Scooter::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Scooter::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Scooter::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Scooter::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Scooter::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Scooter::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Scooter::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Scooter::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Scooter::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'scooters',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);






                break;






            case 'taxiaeroports':



                $this->listingcategory = Taxiaeroport::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'passengers' => $this->listingcategory->passengers,
                                        'luggage' => $this->listingcategory->luggage,
                                        'storage' => $this->listingcategory->storage,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Taxiaeroportsimg::where('taxiaeroport_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place







                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Taxiaeroport::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'taxiaeroports',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Taxiaeroport::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Taxiaeroport::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Taxiaeroport::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Taxiaeroport::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Taxiaeroport::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Taxiaeroport::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Taxiaeroport::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Taxiaeroport::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Taxiaeroport::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Taxiaeroport::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Taxiaeroport::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Taxiaeroport::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Taxiaeroport::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Taxiaeroport::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Taxiaeroport::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Taxiaeroport::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Taxiaeroport::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'taxiaeroports',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],







                                ],
                            ],
                        ]);







                break;





            case 'transportations':



                $this->listingcategory = Transportation::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'passengers' => $this->listingcategory->passengers,
                                        'luggage' => $this->listingcategory->luggage,
                                        'condition' => $this->listingcategory->condition,
                                        'duration' => $this->listingcategory->duration,
                                        'gearbox' => $this->listingcategory->gearbox,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Transportationsimg::where('transportation_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place





                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Transportation::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'transportations',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Transportation::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Transportation::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Transportation::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Transportation::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Transportation::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Transportation::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Transportation::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Transportation::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Transportation::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Transportation::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Transportation::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Transportation::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Transportation::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Transportation::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Transportation::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Transportation::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Transportation::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'transportations',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;







            case 'velos':



                $this->listingcategory = Velo::where('url', $url)->first();
                        $this->reservations = $this->listingcategory->reservation()->orderBy('reservationstart')->get();
                        $this->reviewslistings = $this->listingcategory->review()->orderBy('created_at')->get();
                        $this->user = User::where('id', $this->listingcategory->user_id)->first();



                        // Calculate total reviews and average rating
                        $totalReviews = $this->reviewslistings->count();
                        $averageRating = $totalReviews > 0 ? $this->reviewslistings->avg('rating') : 0;



                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $this->listingcategory->id,
                                'attributes' => [
                                    'title' => $this->listingcategory->title,
                                    'price' => $this->listingcategory->price,
                                    'description' => $this->listingcategory->description,
                                    'startdate' => $this->listingcategory->startdate,
                                    'enddate' => $this->listingcategory->enddate,
                                    'address' => $this->listingcategory->address,
                                    'city' => $this->listingcategory->city,


                                    'picture' => $this->listingcategory->picture,





                                    'country' => $this->listingcategory->country,
                                    'zip' => $this->listingcategory->zip,
                                    'category' => $this->category,
                                    'url' => $this->url,

                                    'specifications' => [
                                        'bike_type' => $this->listingcategory->bike_type,
                                        'seatpost' => $this->listingcategory->seatpost,
                                        'condition' => $this->listingcategory->condition,
                                        'storage' => $this->listingcategory->storage,
                                        'fork' => $this->listingcategory->fork,
                                        'gear' => $this->listingcategory->gear,
                                        'more_details' => $this->listingcategory->more_details,

                                    ],


                                    'created_ad' => $this->listingcategory->created_ad,
                                    'reservations' => $this->reservations->map(function ($reservation) {
                                        return [
                                            'start' => $reservation->reservationstart,
                                            'end' => $reservation->reservationsend,
                                        ];
                                    }),

                                    'reviewslistings' => $this->reviewslistings->map(function ($review) {
                                        return [
                                            'id' => $review->id, // Ensure id is included

                                            'name' => $review->name,
                                            'rating' => $review->rating,
                                            'message' => $review->description,
                                            'helpful' => $review->like,

                                            'created_at' => $review->created_at->toIso8601String(),


                                            'replies' => $review->reviewreply->map(function ($reply) {
                                            return [
                                                'id' => $reply->id,
                                                'name' => $reply->name,
                                                'picture' => $reply->picture,
                                                'message' => $reply->message,
                                                'created_at' => $reply->created_at->toIso8601String(),
                                            ];
                                        }),




                                        ];
                                    }),




                                    'images' => Velosimg::where('velo_id', $this->listingcategory->id)->get()->map(function ($image) {
                                        return $image->picture;
                                    }),

                                    'seller' => [
                                        'name' => $this->user->name,
                                        'profile_image' => $this->user->profile_image,
                                        'created_at' => $this->user->created_at->toIso8601String(),

                                    ],


                                    'total_reviews' => $totalReviews,
                                    'average_rating' => round($averageRating, 1), // Rounded to one decimal place






                                    'favorites' => $favoriteIds,


                                    'recentlistings' => Velo::orderBy('created_at', 'desc')->take(10)->get()->map(function ($recentlisting) {
                                        return [

                                            'attributes' => [

                                            'title' => $recentlisting->title,
                                            'price' => $recentlisting->price,
                                            'city' => $recentlisting->city,
                                            'id' => $recentlisting->id,
                                            'category' => 'velos',
                                            'url' => $recentlisting->url,
                                            'created_at' => $recentlisting->created_at->toIso8601String(),
                                            'picture' => $recentlisting->picture,
                                            ],

                                        ];
                                    }),


                                    'recentlistingscasablanca' => Velo::where('city', 'Casablanca')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmarrakech' => Velo::where('city', 'Marrakech')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingstanger' => Velo::where('city', 'Tanger')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'recentlistingsrabat' => Velo::where('city', 'Rabat')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsfes' => Velo::where('city', 'Fes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsagadir' => Velo::where('city', 'Agadir')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsmeknes' => Velo::where('city', 'Meknes')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),

                                    'recentlistingsojuda' => Velo::where('city', 'Oujda')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),






                                    'recentlistingskenitra' => Velo::where('city', 'Kenitra')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstetouan' => Velo::where('city', 'Tetouan')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssale' => Velo::where('city', 'Salé')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingstemara' => Velo::where('city', 'Temara')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingssafi' => Velo::where('city', 'Safi')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsmohammedia' => Velo::where('city', 'Mohammedia')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingskhouribga' => Velo::where('city', 'Khouribga')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentListingseljadida' => Velo::where('city', 'El Jadida')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),
                                    'recentlistingsbenimellal' => Velo::where('city', 'Beni Mellal')->orderBy('created_at', 'desc')->take(12)->get()->map(function ($recentlisting) {
                                        return [
                                            'attributes' => [
                                                'title' => $recentlisting->title,
                                                'price' => $recentlisting->price,
                                                'city' => $recentlisting->city,
                                                'id' => $recentlisting->id,
                                                'category' => 'velos',
                                                'url' => $recentlisting->url,
                                                'created_at' => $recentlisting->created_at->toIso8601String(),
                                                'picture' => $recentlisting->picture,
                                            ],
                                        ];
                                    }),




                                    'socials' => [
                                            'facebook' => $generaleinfo->facebook,
                                            'twitter' => $generaleinfo->twitter, // X / Twitter
                                            'instagram' => $generaleinfo->instagram,
                                            'linkedin' => $generaleinfo->linkedin,
                                            'pinterest' => $generaleinfo->pinterest,
                                            'telegram' => $generaleinfo->telegram,
                                            'tiktok' => $generaleinfo->tiktok,
                                            'youtube' => $generaleinfo->youtube,
                                    ],








                                ],
                            ],
                        ]);





                break;






            default:
                // Default code
                break;
        }








    }






    public function createReview(Request $request, $category, $url)
    {



                // Validate the request data
                $validatedData = $request->validate([
                    'name' => 'required|string|max:255',
                    'email' => 'required|email|max:255',
                    'description' => 'required|string|max:255',
                    'rating' => 'required|numeric|min:1|max:5',

                ]);

                $this->category = $category;

                $this->url = $url;










        switch ($this->category) {



                    case 'billiards':



                        $this->listingcategory = Billiard::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'billiard_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;





                    case 'boxings':



                        $this->listingcategory = Boxing::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'boxing_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'divings':



                        $this->listingcategory = Diving::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'diving_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'footballs':



                        $this->listingcategory = Football::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'football_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'golfs':



                        $this->listingcategory = Golf::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'golf_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;








                    case 'huntings':



                        $this->listingcategory = Hunting::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'hunting_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'musculations':



                        $this->listingcategory = Musculation::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'musculation_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;








                    case 'surfs':



                        $this->listingcategory = Surf::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'surf_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'tennis':



                        $this->listingcategory = Tennis::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'tennis_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'audios':



                        $this->listingcategory = Audio::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'audio_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'cameras':



                        $this->listingcategory = Camera::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'camera_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'chargers':



                        $this->listingcategory = Charger::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'charger_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;






                    case 'drones':



                        $this->listingcategory = Drone::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'drone_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;









                    case 'gamings':



                        $this->listingcategory = Gaming::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'gaming_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'laptops':



                        $this->listingcategory = Laptop::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'laptop_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;








                    case 'lightings':



                        $this->listingcategory = Lighting::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'lighting_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;








                    case 'printers':



                        $this->listingcategory = Printer::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'printer_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'routers':



                        $this->listingcategory = Router::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'router_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;







                    case 'tablettes':



                        $this->listingcategory = Tablette::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'tablette_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;







                    case 'eclairages':



                        $this->listingcategory = Eclairage::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'eclairage_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'mobiliers':



                        $this->listingcategory = Mobilier::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'mobilier_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'photographies':



                        $this->listingcategory = Photographie::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'photographie_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'sonorisations':



                        $this->listingcategory = Sonorisation::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'sonorisation_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;







                    case 'tentes':



                        $this->listingcategory = Tente::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'tente_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'clothes':



                        $this->listingcategory = Clothes::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'clothes_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'jewelrys':



                        $this->listingcategory = Jewelry::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'jewelry_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'apartments':



                        $this->listingcategory = Apartment::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'apartment_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'bureauxs':



                        $this->listingcategory = Bureaux::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'bureaux_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;






                    case 'magasins':



                        $this->listingcategory = Magasin::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'magasin_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'maisons':



                        $this->listingcategory = Maison::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'maison_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'riads':



                        $this->listingcategory = Riad::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'riad_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;





                    case 'terrains':



                        $this->listingcategory = Terrain::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'terrain_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;







                    case 'villas':



                        $this->listingcategory = Villa::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'villa_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'activities':



                        $this->listingcategory = Activity::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'activity_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'livres':



                        $this->listingcategory = Livre::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'livre_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'musicals':



                        $this->listingcategory = Musical::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'musical_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'furnitures':



                        $this->listingcategory = Furniture::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'furniture_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'houseappliances':



                        $this->listingcategory = Houseappliance::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'houseappliance_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'electricaltools':



                        $this->listingcategory = Electricaltool::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'electricaltool_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);






                        break;






                    case 'ladders':



                        $this->listingcategory = Ladder::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'ladder_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'mechanicaltools':



                        $this->listingcategory = Mechanicaltool::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'mechanicaltool_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;





                    case 'powertools':



                        $this->listingcategory = Powertool::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'powertool_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'pressurewashers':



                        $this->listingcategory = Pressurewasher::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'pressurewasher_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'services':



                        $this->listingcategory = Service::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'service_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);





                        break;






                    case 'boats':



                        $this->listingcategory = Boat::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'boat_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;






                    case 'camions':



                        $this->listingcategory = Camion::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'camion_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;





                    case 'caravans':



                        $this->listingcategory = Caravan::where('url', $url)->first();



                $this->review = Review::create([
                    'name' => $validatedData['name'],
                    'rating' => $validatedData['rating'],
                    'email' => $validatedData['email'],
                    'url' =>$this->url ,
                    'category' =>$this->category ,
                    'listings_thumb' =>$this->listingcategory->picture ,
                    'listings_title' =>$this->listingcategory->title ,
                    'listings_price' =>$this->listingcategory->price ,
                    'listings_description' =>$this->listingcategory->description ,
                    'description' =>$validatedData['description'],



                    'caravan_id' =>$this->listingcategory->id,
                    'user_id'=> $this->listingcategory->user_id,

                    'onlinestore_id'=> $this->listingcategory->user_id,


                ]);




                return response()->json([
                    'data' => [
                        'type' => $this->category,
                        'id' => $this->review->id,
                        'attributes' => [
                            'name' => $this->review->name,
                            'rating' => $this->review->rating,
                            'description' => $this->review->description,
                            'created_at' => $this->review->created_at->toIso8601String(),





                        ],
                    ],
                ]);




                        break;





                    case 'cars':



                    $this->listingcategory = Car::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'car_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;





                case 'engins':



                    $this->listingcategory = Engin::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'engin_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);






                    break;





                case 'motos':



                    $this->listingcategory = Moto::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'moto_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;





                case 'scooters':



                    $this->listingcategory = Scooter::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'scooter_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;






                case 'taxiaeroports':



                    $this->listingcategory = Taxiaeroport::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'taxiaeroport_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;





                case 'transportations':



                    $this->listingcategory = Transportation::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'transportation_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;







                case 'velos':



                    $this->listingcategory = Velo::where('url', $url)->first();



            $this->review = Review::create([
                'name' => $validatedData['name'],
                'rating' => $validatedData['rating'],
                'email' => $validatedData['email'],
                'url' =>$this->url ,
                'category' =>$this->category ,
                'listings_thumb' =>$this->listingcategory->picture ,
                'listings_title' =>$this->listingcategory->title ,
                'listings_price' =>$this->listingcategory->price ,
                'listings_description' =>$this->listingcategory->description ,
                'description' =>$validatedData['description'],



                'velo_id' =>$this->listingcategory->id,
                'user_id'=> $this->listingcategory->user_id,

                'onlinestore_id'=> $this->listingcategory->user_id,


            ]);




            return response()->json([
                'data' => [
                    'type' => $this->category,
                    'id' => $this->review->id,
                    'attributes' => [
                        'name' => $this->review->name,
                        'rating' => $this->review->rating,
                        'description' => $this->review->description,
                        'created_at' => $this->review->created_at->toIso8601String(),





                    ],
                ],
            ]);





                    break;






                default:
                    // Default code
                    break;
        }






    }




    public function addToHelpful(Request $request, $category, $url, $reviewId)
    {
        $review = Review::find($reviewId);

        if ($review) {
            $review->like += 1;
            $review->save();

            return response()->json([
                'success' => true,
                'likes' => $review->like
            ]);
        }

        return response()->json(['success' => false], 404);
    }



    public function createReviewReply(Request $request, $category, $url, $reviewId)
    {
                        $review = Review::find($reviewId);

                        $user = Auth::user();

                        // Validate the request data
                        $validatedData = $request->validate([
                            'message' => 'required|string|max:255',


                        ]);




                        $Reviewreply = Reviewreply::create([
                            'message' => $validatedData['message'],


                            'picture' => $user->profile_image ,
                            'name' => $user->name ,
                            'email' => $user->email ,




                            'review_id' =>$reviewId,
                            'user_id'=> $user->id,

                        ]);




                        return response()->json([
                            'data' => [
                                'type' => $this->category,
                                'id' => $Reviewreply->id,
                                'attributes' => [
                                    'name' => $review->name,
                                    'message' => $Reviewreply->message,
                                    'picture' => $Reviewreply->picture,
                                    'created_at' => $Reviewreply->created_at->toIso8601String(),





                                ],
                            ],
                        ]);



    }



}
